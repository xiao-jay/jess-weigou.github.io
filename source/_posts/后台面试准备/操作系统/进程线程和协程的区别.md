---
title: 进程线程和协程的区别

---

进程是操作系统分配资源的最小单位

线程是操作系统所能调度执行的最小单位

协程是用户态的轻量级线程，操作系统所不能开辟的，但是可以由程序控制

一个进程中有多个线程，一个线程里面可以有多个协程，因为进程是最大的了，进程切换需要的开销很大，但是进程挂了，其他进程因为保护机制会不受影响，但是这个进程里面的线程协程也都会挂掉。

### 协程的优势

1、极高的执行效率，因为子程序切换不是线程切换，而是程序自身切换，没有线程切换开销效率高。

2、不需要多线程的锁机制，因为只有一个线程不存在同时写变量冲突。



### 为什么协程切换代价比线程低

协程切换流程：

1、保存当前寄存器信息

2、选择下一个要执行的协程

3、恢复寄存器上下文

线程切换流程：

1、软中断

2、保存寄存器信息到内核堆栈、

3、选择下一个要执行的线程

4、恢复上下文

5、返回用户堆栈

需要保存的寄存器信息大小不同，线程需要把寄存器保存到内核堆栈，并且 返回用户堆栈

协程无多线程锁机制，因为一个协程运行就一个线程。

协程，是一种比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。

**协程在子程序内部是可中断的，然后转而执行别的子程序，在适当的时候再返回来接着执行**。

协程的特点在于是一个线程执行

极高的执行效率：因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显；

不需要多线程的锁机制：因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。
