---
title: k8s 探针
excerpt: 所在模块：k8s
tags: [k8s]
categories: 后端面试
banner_img: /img/壁纸.jpg
---

### 探针的三种机制

HTTP GET：该类型的探针对容器的ip地址和执行HTTP GET请求，如果响应的状态码大于等于 200 且小于 400，则诊断被认为是成功的。
TCP套接字：该类型的探针尝试与容器指定端口建立TCP连接，如果端口打开，则诊断被认为是成功的。
Exec：该类型的探针在容器内执行任意的命令，如果命令退出时返回码为 0 则认为诊断成功
每次探测都将获得以下三种结果之一：

Success（成功）：容器通过了诊断。
Failure（失败）：容器未通过诊断。
Unknown（未知）：诊断失败，因此不会采取任何行动。

### 探针的三种类型

存活指针，就绪指针，启动指针



### liveness（存活指针）

存活指针,该指针用来指示容器是否正在运行。kubernetes根据存活指针来检查容器是否正常运行，若探测失败，则 kubelet 会杀死容器， 并且容器将根据其重启策略去处理。



### Readiness（就绪指针）

该指针用来指示容器是否准备好为请求提供服务。如果就绪态探测失败，kubelet将该Pod提供的所有服务的endpoint列表中删除该Pod的 IP地址。
Kubernetes根据就绪指针来检测pod中的容器是否已经就绪，在发布应用时很有必要在pod中添加该指针，K8s会根据pod是否就绪决定是否将该pod放入该服务中，从而保证服务集群中的pod都是可以提供服务的。

与存活指针的区别在于，若容器未通过检查准备，则不会被终止或重新启动。存活探针通过杀死异常的容器并用新的容器去替代他们的工作，而就绪探针确保只有准备好处理请求的pod才能在服务集群中。


### 启动指针

该指针用来指示容器中的应用是否已经启动，如果使用了启动探针，则所有其他探针都会被禁用，直到此探针成功为止。如果启动探测失败，kubelet将杀死容器，而容器依其重启策略进行重启。
