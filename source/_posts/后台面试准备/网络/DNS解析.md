---
title: DNS解析
excerpt: 所在模块：计算机网络
tags: [计算机网络]
categories: 后端面试
banner_img: /img/壁纸.jpg
---

### 域名(Domain)

```bash
mail.ccav.com
---- ---- ----
三级域名 二级域名 顶级域名
```

域名的层级是按照上面这么划分的，每级域名长度不超过63个字符，不区分大小写，只能使用数字字母和-。一个完整的域名不超过255个字符。

## 域名服务器划分

了解域名服务器划分之后，就会对DNS解析的过程大概有些了解。域名服务器按照层级分为：

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h0g3n3117yj20kb08dmxy.jpg)

### 本地域名服务器

本地域名服务器相当于一个班主任，你有点啥事都找他。当一个主机发出DNS查询的时候，这个查询的请求就会发送到本地域名服务器。

### 根域名服务器

根域名服务器是最高层次的域名服务，是校长,只负责规划大方向。他知道所有顶级域名服务器的域名和IP地址。不管那个本地域名服务器若自己不能不能解析，那首先请求的就是根域名服务器。根域名服务器不会把待查询的域名直接转换成IP，而是告诉本地域名服务器下一步应该找哪一个顶级域名服务器进行查询。

### 顶级域名服务器

顶级域名服务器是负责各个方向的副校长，有负责安全的，有负责教学的。他负责管理该顶级域名下的所有二级域名，当收到DNS查询请求后就会给出响应的应答，可能是最终的结果，也可能是下一步应该找到的域名服务器的IP地址。

### 权限域名服务器

权限域名服务器就是负责一个区的域名服务器，是基层干活的，比如宿管，各科老师，他负责一个更小的区域。当一个权限服务还不能给出最后的回答时，就会告诉查询请求的DNS客户，下一步应该找哪个权限域名服务器。

## 域名查询的两种方式

### 递归查询

递归查询，就是你找我要一个域名的IP地址，但是我不知道，那我去帮你去向知道的人问这个IP地址。举个例子就是，你问你班主任怎么做番茄炒鸡蛋，你班主任不知道，但是你班主任去问了食堂厨师，然后告诉你。这就叫递归查询。
从host到本地域名服务器一般是用的递归查询。

### 迭代查询

迭代查询就是，你找我要一个域名的IP地址，我也不知道这个IP地址，但是我知道谁知道，我告诉你去找谁问。举个例子就是，你们班主任到了食堂随便拉了个人问怎么做番茄炒鸡蛋，那个人说，我只是个卖饭的，我不知道，但是我知道A君是在后厨的，你可以去问A君。然后你班主任就去问A君了。呐，这就叫迭代查询。
从本地域名服务器到根域名服务器一般是用的迭代查询。

行了，该知道的储备知识我们知道的差不多了，接下来就看看关键的流程吧。

#### dns解析默认是什么方式查询

主机向本地域名服务器的查询一般都是采用递归查询。

本地域名服务器向根域名服务器的查询的迭代查询。

# DNS查询步骤

假设一台主机想知道y.abc.com这个域名的IP地址，那么整个的查询过程如下：

1. 主机先向其本地域名服务器进行递归查询
2. 本地域名服务器采用迭代的查询，它先向根域名服务器查询
3. 根域名服务器告诉本地域名服务器，下一次应该查询的顶级域名服务器的IP地址。
4. 本地域名服务器向顶级域名服务器发起查询。
5. 顶级域名服务器告诉本地域名服务器，下一次应查询的权限域名服务器IP地址
6. 本地域名服务器向权限域名服务器发起查询。
7. 权限域名服务器告诉本地域名服务器所查询的IP地址。
8. 本地域名服务器把查询结果告诉主机
